
R Under development (unstable) (2019-06-21 r76731) -- "Unsuffered Consequences"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(durmod)
> data.table::setDTthreads(1)
> set.seed(42)
> dataset <- datagen(4000,1200)
> print(dataset)
        id         x1         x2 alpha         d  duration
   1:    1  1.3709584 -0.1418087     0      exit  1.123083
   2:    2  0.2984146 -1.5918203     0      none 14.543001
   3:    2  0.2984146 -1.5918203     0      exit  4.139920
   4:    3  0.3631284 -0.3255406     0 treatment 22.891390
   5:    3  0.3631284 -0.3255406     1      exit  5.809067
  ---                                                     
8806: 3998  1.8651969  0.5667597     1      none  7.818901
8807: 3998  1.8651969  0.5667597     1      exit  7.991203
8808: 3999  0.8504394  1.3854584     0 treatment  2.352759
8809: 3999  0.8504394  1.3854584     1      exit  4.587245
8810: 4000 -0.4080361 -1.1617422     0      exit  1.589720
> risksets <- list(untreated=c(1,2), treated=c(1))
> # just two iterations to save time
> opt <- mphcrm(d ~ x1+x2|alpha, data=dataset, id=id, durvar=duration,state=alpha+1,risksets=risksets,
+               control=mphcrm.control(threads=1,iters=2,callback=NULL))
> best <- opt[[1]]
> print(best)
Estimate with 2 points, log-likelihood: -21023.3863
     exit.x1      exit.x2   exit.alpha treatment.x1 treatment.x2        pargs 
   0.7566441   -0.7417405   -0.2662034    0.8625342    0.3759226   -0.9135190 

Proportional hazard distribution
              prob       exit  treatment
point  1 0.7137197 0.15492189 0.09249743
point  2 0.2862803 0.01894386 0.01813079
> summary(best)
$loglik
[1] -21023.39

$coefs
                  value          se          t      Pr(>|t|)
exit.x1       0.7566441 0.009642982  78.465779  0.000000e+00
exit.x2      -0.7417405 0.013262129 -55.929216  0.000000e+00
exit.alpha   -0.2662034 0.034961284  -7.614234  2.926374e-14
treatment.x1  0.8625342 0.023189411  37.195174 2.094111e-281
treatment.x2  0.3759226 0.023396286  16.067617  2.790888e-57
pargs        -0.9135190 0.054778830 -16.676497  1.693323e-61

$moments
                mean    variance         sd
exit      0.11599406 0.003777954 0.06146506
treatment 0.07120773 0.001129992 0.03361536

> 
> proc.time()
   user  system elapsed 
  3.678   0.579   3.516 
